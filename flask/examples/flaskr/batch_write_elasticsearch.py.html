
# coding: utf-8

# ## Elasticsearch batch write test
# ### compiled by Ryan

# Tutorial: https://elasticsearch-py.readthedocs.io/en/master/

# ## Tutorial Code

# In[23]:


from datetime import datetime
from elasticsearch import Elasticsearch

es = Elasticsearch()

'''
put
'''

doc = {
    'author': 'ryan',
    'text': 'this guy is very handsome',
    'timestamp': datetime.now(),
}

res_in  = es.index(index="job_id", doc_type='text', id=1, body=doc)


# In[24]:


res_out = es.get(index="job_id", doc_type='text', id=1)

print(res_out)


# ## Upscale Code - Batch w/o

# In[28]:


es = Elasticsearch()
'''
put
'''

def put_element(title, company, description, job_id):
    
    doc = {'title': title,  
           'company': company,
           'description': description}
    
    res_in  = es.index(body=doc,
                       index="job", 
                       doc_type='text',
                       id= job_id)
    
    res_out = es.get(index="job",
                     doc_type='text',
                     id= job_id)
    
    #print('{} has been written into Elasticsearch'.format(res_out))


# In[29]:


put_element('data science', 'rbc', 'machine learning devops', 2001)


# In[30]:


import pandas as pd
df_jobs = pd.read_csv('data/ds.csv')
df_jobs.head(3)
job_title = df_jobs.jobtitle
job_company = df_jobs.company
job_description = df_jobs.description


# In[31]:


for index, row in df_jobs.iterrows():
    put_element(row['jobtitle'], row['company'], row['description'], row['Unnamed: 0'])


# In[42]:


res_out = es.get(index="job", doc_type='text', id=0)
print(res_out)


# http://localhost:9200/job/text/3

# In[38]:


es.indices.refresh(index="job_id")

res = es.search(index="job_id", body={"query": {"match_all": {}}})

print("Got %d Hits:" % res['hits']['total'])

for hit in res['hits']['hits']:
    print(hit)

